<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>Gestor de Inventario Mejorado</title>
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <!-- Estilos propios -->
    <link rel="stylesheet" href="style.css">
    <!-- Librerías externas -->
    <script src="https://cdn.jsdelivr.net/npm/xlsx@0.18.5/dist/xlsx.full.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>
</head>
<body>
    <header>
        <h1>Gestor de Inventario</h1>
    </header>
    <div class="container" id="registerContainer">
        <h2>Registro</h2>
        <div class="form-row">
            <label for="regEmail">Correo electrónico</label>
            <input type="email" id="regEmail" placeholder="ejemplo@dominio.com" required>
        </div>
        <div class="form-row">
            <label for="regNombre">Tu nombre</label>
            <input type="text" id="regNombre" placeholder="Nombre completo" required>
        </div>
        <button onclick="registerUser()">Crear perfil</button>
        <div class="small" style="margin-top:1em;color:#b44;">
            <b>Nota de seguridad:</b> Esta es una demo, sin autenticación real.<br>
            No uses datos sensibles.
        </div>
    </div>
    <div class="container" id="userformContainer" style="display:none;">
        <div class="center small" id="perfilInfo"></div>
        <div class="dropdown" id="userDropdown">
            <button class="dropdown-btn" onclick="toggleDropdown()">Abrir gestor de cliente</button>
            <div class="dropdown-content">
                <div class="form-row">
                    <label for="nombreClienteInput">Cliente</label>
                    <input type="text" id="nombreClienteInput" placeholder="Introduce o selecciona el cliente">
                    <select id="clientesRecientes" onchange="selectRecentClient(this.value)">
                        <option value="">--Historial--</option>
                    </select>
                </div>
                <div id="labelCliente" class="status-label waiting">Introduce el nombre del cliente</div>
                <div class="flex">
                    <button onclick="setClientName()" style="flex:2;">Establecer Nombre</button>
                    <button onclick="clearForm()" style="flex:1;">Limpiar</button>
                </div>
                <div class="form-row">
                    <button onclick="exportSession()">Exportar sesión</button>
                    <button onclick="importSession()">Importar sesión</button>
                    <input type="file" id="importSessionFile" style="display:none;" accept=".json">
                </div>
                <div class="status-label waiting" id="labelInv">
                    Esperando Inventario...
                    <input type="file" id="fileInventario" accept=".xlsx,.xls,.csv" style="display:none;">
                    <button id="btnImportInv" onclick="document.getElementById('fileInventario').click()" disabled>Importar Inventario</button>
                </div>
                <div class="status-label waiting" id="labelVentas">
                    Esperando Ventas...
                    <input type="file" id="fileVentas" accept=".xlsx,.xls,.csv" style="display:none;">
                    <button id="btnImportVentas" onclick="document.getElementById('fileVentas').click()" disabled>Importar Ventas</button>
                </div>
                <div class="status-label waiting" id="labelComp">
                    Esperando Comparativa...
                    <input type="file" id="fileComparativa" accept=".xlsx,.xls,.csv" style="display:none;">
                    <button id="btnImportComp" onclick="document.getElementById('fileComparativa').click()" disabled>Importar Comparativa</button>
                </div>
                <div class="btn-group">
                    <button id="btnProcesar" onclick="processData()" disabled>Procesar Datos</button>
                    <button onclick="showDashboard()" disabled id="btnDashboard">Ver Resultados</button>
                    <button onclick="showHistory()">Historial</button>
                    <button onclick="logout()" style="background:#b44;">Salir</button>
                </div>
            </div>
        </div>
        <!-- Dashboard básico integrado -->
        <div id="dashboardContainer" style="display:none;margin-top:2em;">
            <h2>Dashboard Rápido</h2>
            <div id="dashboardKpis" class="kpi-panel"></div>
            <input type="text" id="filterInput" placeholder="Filtrar por código o descripción...">
            <div id="dashboardTable"></div>
            <canvas id="ventasChart" height="120"></canvas>
            <div style="margin-top:2em;">
                <button onclick="openAdvancedDashboard()">Abrir Dashboard Avanzado</button>
            </div>
        </div>
        <!-- Historial -->
        <div id="historyContainer" style="display:none;margin-top:2em;">
            <h2>Historial de sesiones</h2>
            <ul id="historyList"></ul>
            <button onclick="closeHistory()">Cerrar historial</button>
        </div>
    </div>
    <footer class="center" style="margin:3em 0 1em 0;">
        &copy; <span id="year"></span> - Gestor de Inventario Mejorado
    </footer>
    <script src="main.js"></script>
    <script>
        // Añadir el año actual al footer
        document.getElementById('year').textContent = new Date().getFullYear();

        // Permitir apertura directa del dashboard avanzado
        function openAdvancedDashboard() {
            window.open('dashboard.html', '_blank');
        }
    </script>
</body>
</html>